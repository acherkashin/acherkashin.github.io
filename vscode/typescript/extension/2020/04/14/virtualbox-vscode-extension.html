<!DOCTYPE html>
<html lang="en">
  <head><meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta http-equiv="X-UA-Compatible" content="ie=edge">
<link href="https://fonts.googleapis.com/css?family=Merriweather:300|Raleway:400,700" rel="stylesheet">
<link rel="stylesheet" href="/assets/css/style.css">
<title>Пишем Visual Studio Code extension для VirtualBox</title>
<!-- Begin Jekyll SEO tag v2.6.1 -->
<title>Пишем Visual Studio Code extension для VirtualBox</title>
<meta name="generator" content="Jekyll v4.0.0" />
<meta property="og:title" content="Пишем Visual Studio Code extension для VirtualBox" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="VS Code достаточно мощный инструмент, куда с помощью различных расширений интегрирована куча всевозможных инстрементов. Мне всегда невероятно больно, когда нужно покидать его, потому что я сразу начинаю путаться в окнах и забываю что я вообще хотел сделать. Я думаю каждый хоть раз терялся в трех соснах во всех открытых им окнах, поэтому предположу, что вам это знакомо. У меня установлено несколько виртуальных машин, и меня невероятно раздражает, что для их запуска нужно открыть VirtualBox просто чтобы нажать кнопку Run. Собственно говоря, сегодня я раскажу, как избавился от своей боли." />
<meta property="og:description" content="VS Code достаточно мощный инструмент, куда с помощью различных расширений интегрирована куча всевозможных инстрементов. Мне всегда невероятно больно, когда нужно покидать его, потому что я сразу начинаю путаться в окнах и забываю что я вообще хотел сделать. Я думаю каждый хоть раз терялся в трех соснах во всех открытых им окнах, поэтому предположу, что вам это знакомо. У меня установлено несколько виртуальных машин, и меня невероятно раздражает, что для их запуска нужно открыть VirtualBox просто чтобы нажать кнопку Run. Собственно говоря, сегодня я раскажу, как избавился от своей боли." />
<link rel="canonical" href="http://localhost:4000/vscode/typescript/extension/2020/04/14/virtualbox-vscode-extension.html" />
<meta property="og:url" content="http://localhost:4000/vscode/typescript/extension/2020/04/14/virtualbox-vscode-extension.html" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2020-04-14T16:30:32+03:00" />
<script type="application/ld+json">
{"@type":"BlogPosting","headline":"Пишем Visual Studio Code extension для VirtualBox","dateModified":"2020-04-14T16:30:32+03:00","datePublished":"2020-04-14T16:30:32+03:00","mainEntityOfPage":{"@type":"WebPage","@id":"http://localhost:4000/vscode/typescript/extension/2020/04/14/virtualbox-vscode-extension.html"},"url":"http://localhost:4000/vscode/typescript/extension/2020/04/14/virtualbox-vscode-extension.html","description":"VS Code достаточно мощный инструмент, куда с помощью различных расширений интегрирована куча всевозможных инстрементов. Мне всегда невероятно больно, когда нужно покидать его, потому что я сразу начинаю путаться в окнах и забываю что я вообще хотел сделать. Я думаю каждый хоть раз терялся в трех соснах во всех открытых им окнах, поэтому предположу, что вам это знакомо. У меня установлено несколько виртуальных машин, и меня невероятно раздражает, что для их запуска нужно открыть VirtualBox просто чтобы нажать кнопку Run. Собственно говоря, сегодня я раскажу, как избавился от своей боли.","@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->
</head>
  <body>
    <main class="container">
      <section class="about">
        <a href="/"><img src="/assets/portfolio.png" alt="Cherkashin Alexander"></a>
        <h2 id="title">
          <a href="/">Cherkashin Alexander</a>
        </h2>
        <p class="tagline">Developer</p>
        <ul class="social"><a href="https://github.com/acherkashin">
              <li>
                <i class="icon-github-circled"></i>
              </li>
            </a></ul><p>&copy;
          2020</p>
      </section>
      <section class="content">
        <div class="post-container">
  <a class="post-link" href="/vscode/typescript/extension/2020/04/14/virtualbox-vscode-extension.html">
    <h2 class="post-title">Пишем Visual Studio Code extension для VirtualBox</h2>
  </a>
  <div class="post-meta">
    <ul class="post-categories"><li>vscode</li><li>typescript</li><li>extension</li></ul>
    <div class="post-date"><i class="icon-calendar"></i>Apr 14, 2020</div>
  </div>
  <div class="post">
    <p>VS Code достаточно мощный инструмент, куда с помощью различных расширений интегрирована куча всевозможных инстрементов. Мне всегда невероятно больно, когда нужно покидать его, потому что я сразу начинаю путаться в окнах и забываю что я вообще хотел сделать. Я думаю каждый хоть раз терялся <del>в трех соснах</del> во всех открытых им окнах, поэтому предположу, что вам это знакомо. У меня установлено несколько виртуальных машин, и меня невероятно раздражает, что для их запуска нужно открыть VirtualBox просто чтобы нажать кнопку <strong>Run</strong>. Собственно говоря, сегодня я раскажу, как избавился от своей боли.</p>
<p>Это статья проведет вас через весь путь создания VirtualBox extension - от генерации базового шаблона, до управления виртуалками из VS Code.</p>
<h2 id="research">Research</h2>
<p>Прежде чем бежать сломя голову и начинать что-то писать, нужно посмотреть, возможно уже есть что-то готовое. Поэтому отправлямся в <a href="https://marketplace.visualstudio.com/vscode">VSCode Marketplace</a> и убеждаемся, что, к сожалению, ничего готового нет, и всё придется делать самим. Но ещё не все потеряно, и мы отправляемся на просторы <a href="https://github.com/">github</a>, чтобы найти хоть что-то и находим npm пакет <a href="https://github.com/Node-Virtualization/node-virtualbox">node-virtualbox</a>, который мы и будем использовать для управления виртуалками.</p>
<h2 id="section">Генерация базового темплейта</h2>
<p>Если вы читаете эту статью, то наверняка у вас установлены <a href="https://nodejs.org/en/">Node.js</a> и <a href="https://git-scm.com/">Git</a>, поэтому просто установите <a href="http://yeoman.io/">Yeoman</a> и <a href="https://www.npmjs.com/package/generator-code">VS Code Extension Generator</a>.</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>npm <span class="nb">install</span> <span class="nt">-g</span> yo generator-code
</code></pre></div></div>
<p>После чего необходимо сгенерировать собственно сам темплейт. Запустите следующую комманду и заполните несколько полей</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>you code

<span class="c"># ? What type of extension do you want to create? New Extension (TypeScript)</span>
<span class="c"># ? What's the name of your extension? virtualbox-vscode-extension</span>
<span class="c">### Press &lt;Enter&gt; to choose default for all options below ###</span>

<span class="c"># ? What's the identifier of your extension? virtualbox-vscode-extension</span>
<span class="c"># ? What's the description of your extension? LEAVE BLANK</span>
<span class="c"># ? Initialize a git repository? Yes</span>
<span class="c"># ? Which package manager to use? yarn</span>

code ./virtualbox-vscode-extension
</code></pre></div></div>
<p>Подробнее о структуре сгенерированного расширения вы можете узнать <a href="https://code.visualstudio.com/api/get-started/extension-anatomy">в официальной документации</a>.</p>
<h2 id="section-1">Немного о компонентах расширения</h2>
<p>Если вы уже некоторое время пользуетесь VSCode и различными расширениями, то наверняка могли заметить, что все они выглядят достаточно стандартизированно. Несмотря на то, что VSCode написан на Electron, это не означает, что вы можете использовать все его API и верстать все что вам захочется. Ну на самом деле, есть <a href="https://code.visualstudio.com/api/extension-guides/webview">одно место, где вам всё дозволено… ну почти всё …</a> В остальном же, весь редактор разбит на определенные секции, которые вы можете расширять с помощью определенных компонентов, одним из которых является <a href="https://code.visualstudio.com/api/extension-guides/tree-view">TreeView</a>, который мы и будем использовать.</p>
<h2 id="section-2">Подготовка</h2>
<p>К сожалению, API предоставляемый пакетом <a href="https://github.com/Node-Virtualization/node-virtualbox">virtualbox</a> работает на колбэках, а сама библиотека написана на JavaScript, поэтому нам необходимо провести некоторую подготовительную работу.</p>
<ol>
<li>Добавим папку <code>typings</code> в корень проекта и создадим в ней файл <code>virtualbox.d.ts</code> со всеми тайпингами, которые нам понадобятся.  Таким образом мы добавляем типизация для библиотеки, которая написана на JS и не содержит готовых тайпингов.</li>
</ol>
<div class="language-ts highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">declare</span> <span class="nx">module</span> <span class="dl">"</span><span class="s2">virtualbox</span><span class="dl">"</span> <span class="p">{</span>
    <span class="k">export</span> <span class="kr">interface</span> <span class="nx">VMList</span> <span class="p">{</span>
        <span class="p">[</span><span class="nx">id</span><span class="p">:</span> <span class="nx">string</span><span class="p">]:</span> <span class="p">{</span> <span class="nl">name</span><span class="p">:</span> <span class="nx">string</span><span class="p">,</span> <span class="nx">running</span><span class="p">:</span> <span class="nx">boolean</span> <span class="p">};</span>
    <span class="p">}</span>

    <span class="k">export</span> <span class="kr">interface</span> <span class="nx">VBoxError</span> <span class="p">{</span>
        <span class="nl">message</span><span class="p">:</span> <span class="nx">string</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">export</span> <span class="kd">function</span> <span class="nx">list</span><span class="p">(</span><span class="nx">callback</span><span class="p">:</span> <span class="p">(</span><span class="nx">list</span><span class="p">:</span> <span class="nx">VMList</span><span class="p">,</span> <span class="nx">error</span><span class="p">?:</span> <span class="nx">VBoxError</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="k">void</span><span class="p">):</span> <span class="k">void</span><span class="p">;</span>
    <span class="k">export</span> <span class="kd">function</span> <span class="nx">start</span><span class="p">(</span><span class="nx">vmId</span><span class="p">:</span> <span class="nx">string</span><span class="p">,</span> <span class="nx">use_gui</span><span class="p">:</span> <span class="nx">boolean</span><span class="p">,</span> <span class="nx">callback</span><span class="p">:</span> <span class="p">(</span><span class="nx">error</span><span class="p">?:</span> <span class="nx">VBoxError</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="k">void</span><span class="p">):</span> <span class="k">void</span><span class="p">;</span>
    <span class="k">export</span> <span class="kd">function</span> <span class="nx">isRunning</span><span class="p">(</span><span class="nx">vmId</span><span class="p">:</span> <span class="nx">string</span><span class="p">,</span> <span class="nx">callback</span><span class="p">:</span> <span class="p">(</span><span class="nx">error</span><span class="p">:</span> <span class="nx">VBoxError</span><span class="p">,</span> <span class="nx">result</span><span class="p">:</span> <span class="nx">boolean</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="k">void</span><span class="p">):</span> <span class="k">void</span><span class="p">;</span>
    <span class="k">export</span> <span class="kd">function</span> <span class="nx">savestate</span><span class="p">(</span><span class="nx">vmId</span><span class="p">:</span> <span class="nx">string</span><span class="p">,</span> <span class="nx">callback</span><span class="p">:</span> <span class="p">(</span><span class="nx">error</span><span class="p">?:</span> <span class="nx">VBoxError</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="k">void</span><span class="p">):</span> <span class="k">void</span><span class="p">;</span>
    <span class="k">export</span> <span class="kd">function</span> <span class="nx">poweroff</span><span class="p">(</span><span class="nx">vmId</span><span class="p">:</span> <span class="nx">string</span><span class="p">,</span> <span class="nx">callback</span><span class="p">:</span> <span class="p">(</span><span class="nx">error</span><span class="p">?:</span> <span class="nx">VBoxError</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="k">void</span><span class="p">):</span> <span class="k">void</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div></div>
<ol start="2">
<li>Проведем <a href="https://learn.javascript.ru/promisify">промисификацию</a>, для интересующих нас методов.</li>
</ol>
<div class="language-ts highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">import</span> <span class="o">*</span> <span class="k">as</span> <span class="nx">virtualbox</span> <span class="k">from</span> <span class="dl">"</span><span class="s2">virtualbox</span><span class="dl">"</span><span class="p">;</span>
<span class="k">import</span> <span class="p">{</span> <span class="nx">promisify</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">"</span><span class="s2">util</span><span class="dl">"</span><span class="p">;</span>

<span class="k">export</span> <span class="kr">interface</span> <span class="nx">VirtualMachine</span> <span class="p">{</span>
    <span class="nl">id</span><span class="p">:</span> <span class="nx">string</span><span class="p">;</span>
    <span class="nl">name</span><span class="p">:</span> <span class="nx">string</span><span class="p">;</span>
    <span class="nl">running</span><span class="p">:</span> <span class="nx">boolean</span><span class="p">;</span>
    <span class="nl">os</span><span class="p">:</span> <span class="nx">string</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">export</span> <span class="kd">const</span> <span class="nx">isRunning</span> <span class="o">=</span> <span class="nx">promisify</span><span class="p">(</span><span class="nx">virtualbox</span><span class="p">.</span><span class="nx">isRunning</span><span class="p">);</span>
<span class="k">export</span> <span class="kd">const</span> <span class="nx">saveState</span> <span class="o">=</span> <span class="nx">promisify</span><span class="p">(</span><span class="nx">virtualbox</span><span class="p">.</span><span class="nx">savestate</span><span class="p">);</span>
<span class="k">export</span> <span class="kd">const</span> <span class="nx">powerOff</span> <span class="o">=</span> <span class="nx">promisify</span><span class="p">(</span><span class="nx">virtualbox</span><span class="p">.</span><span class="nx">poweroff</span><span class="p">);</span>

<span class="k">export</span> <span class="kd">function</span> <span class="nx">startWithGui</span><span class="p">(</span><span class="nx">vmId</span><span class="p">:</span> <span class="nx">string</span><span class="p">):</span> <span class="nb">Promise</span><span class="o">&lt;</span><span class="k">void</span><span class="o">&gt;</span> <span class="p">{</span>
    <span class="k">return</span> <span class="k">new</span> <span class="nb">Promise</span><span class="p">((</span><span class="nx">resolve</span><span class="p">,</span> <span class="nx">reject</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
        <span class="nx">virtualbox</span><span class="p">.</span><span class="nx">start</span><span class="p">(</span><span class="nx">vmId</span><span class="p">,</span> <span class="kc">true</span><span class="p">,</span> <span class="p">(</span><span class="nx">error</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="nx">error</span><span class="p">)</span> <span class="p">{</span>
                <span class="nx">reject</span><span class="p">(</span><span class="nx">error</span><span class="p">);</span>
            <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
                <span class="nx">resolve</span><span class="p">();</span>
            <span class="p">}</span>
        <span class="p">});</span>
    <span class="p">});</span>
<span class="p">}</span>

<span class="k">export</span> <span class="kd">function</span> <span class="nx">getAllVms</span><span class="p">():</span> <span class="nb">Promise</span><span class="o">&lt;</span><span class="nx">VirtualMachine</span><span class="p">[]</span><span class="o">&gt;</span> <span class="p">{</span>
    <span class="k">return</span> <span class="k">new</span> <span class="nb">Promise</span><span class="p">((</span><span class="nx">resolve</span><span class="p">,</span> <span class="nx">reject</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
        <span class="nx">virtualbox</span><span class="p">.</span><span class="nx">list</span><span class="p">(</span><span class="k">async</span> <span class="p">(</span><span class="nx">list</span><span class="p">,</span> <span class="nx">error</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="nx">error</span><span class="p">)</span> <span class="p">{</span>
                <span class="nx">reject</span><span class="p">(</span><span class="nx">error</span><span class="p">);</span>
            <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
                <span class="kd">const</span> <span class="nx">vmsPromise</span> <span class="o">=</span> <span class="nb">Object</span><span class="p">.</span><span class="nx">keys</span><span class="p">(</span><span class="nx">list</span><span class="p">).</span><span class="nx">map</span><span class="p">(</span><span class="k">async</span> <span class="p">(</span><span class="nx">vmId</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">({</span>
                    <span class="na">id</span><span class="p">:</span> <span class="nx">vmId</span><span class="p">,</span>
                    <span class="na">name</span><span class="p">:</span> <span class="nx">list</span><span class="p">[</span><span class="nx">vmId</span><span class="p">].</span><span class="nx">name</span><span class="p">,</span>
                    <span class="na">running</span><span class="p">:</span> <span class="nx">list</span><span class="p">[</span><span class="nx">vmId</span><span class="p">].</span><span class="nx">running</span><span class="p">,</span>
                <span class="p">}</span> <span class="k">as</span> <span class="nx">VirtualMachine</span><span class="p">));</span>

                <span class="kd">const</span> <span class="nx">vms</span> <span class="o">=</span> <span class="k">await</span> <span class="nb">Promise</span><span class="p">.</span><span class="nx">all</span><span class="p">(</span><span class="nx">vmsPromise</span><span class="p">);</span>
                <span class="nx">resolve</span><span class="p">(</span><span class="nx">vms</span><span class="p">);</span>
            <span class="p">}</span>
        <span class="p">});</span>
    <span class="p">});</span>
<span class="p">}</span>
</code></pre></div></div>
<h2 id="contribution-points">Contribution points</h2>
<p>Как я уже говорил ранее, VS Code разбит на определенные секции и предоставляет возможность расширять встроенную функциональность с помощью JSON деклараций, называемых <a href="https://code.visualstudio.com/api/references/contribution-points">Contribution Points</a>. В данном случае нас интересует два вида деклараций: <a href="https://code.visualstudio.com/api/references/contribution-points#contributes.viewsContainers">viewsContainers</a> и <a href="https://code.visualstudio.com/api/references/contribution-points#contributes.views">views</a>. Теперь нам необходимо открыть <code>package.json</code> в папке с расширением и найдем поле <code>contribution</code>, и заменим его содержимое на следующее:</p>
<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nl">"contributes"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nl">"viewsContainers"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="nl">"activitybar"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
        </span><span class="p">{</span><span class="w">
          </span><span class="nl">"id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"virtual-box-explorer"</span><span class="p">,</span><span class="w">
          </span><span class="nl">"title"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Virtual Machines"</span><span class="p">,</span><span class="w">
          </span><span class="nl">"icon"</span><span class="p">:</span><span class="w"> </span><span class="s2">"resources/virtualbox.svg"</span><span class="w">
        </span><span class="p">}</span><span class="w">
      </span><span class="p">]</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="nl">"views"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="nl">"virtual-box-explorer"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
        </span><span class="p">{</span><span class="w">
          </span><span class="nl">"id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"vb-machines"</span><span class="p">,</span><span class="w">
          </span><span class="nl">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Virtual Machines"</span><span class="w">
        </span><span class="p">}</span><span class="w">
      </span><span class="p">]</span><span class="w">
    </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div>
<p>Теперь давайте разберемся, что здесь происходит. Мы объвляем <em>viewContainer</em> с идентификатором <em>virtual-box-explorer</em> и указываем, что он будет находится в <em>activitybar</em>, это хорошо известная нам боковая панель в которой находятся такие <em>viewsContainers</em> как  <em>Explorer</em>, <em>Search</em>, <em>Git</em>, <em>Debugger</em> и т.д.. Далее мы объявлем <em>view</em> с идентификатором <em>vb-machines</em> и указываем, что оно будет находится внутри <em>viewContainer</em> с идентификатором <em>virtual-box-explorer</em>.</p>
<p>Вы наверняка заметили, что я объявил контейнер с иконкой <code>resources/virtualbox.svg</code>. Размер и цвет иконок VS Code также стандартизированы, поэтому я заранее её подготовил, а вы просто скачайте её из <a href="https://github.com/acherkashin/virtualbox-vscode-extension/blob/master/resources/virtualbox.svg">репозитория</a>.</p>
<p>Также стоит остановиться на ещё одном очень важном аспекте. Ваше расширение будет активировано только после запуска активирующего события, которые перечислены в поле <code>actionvationEvents</code> в <code>package.json</code>, это сделано для увеличения производительности, чтобы все расширения не загружались одновременно и не просаживали производительность. Нам необходимо чтобы расширение запускалось при открытии <em>view</em>, для этого заменим его содержимое на следующее:</p>
<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nl">"activationEvents"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
    </span><span class="s2">"onView:vb-machines"</span><span class="w">
</span><span class="p">]</span><span class="w">
</span></code></pre></div></div>
<p>Теперь можем приступить к самой интересной части …</p>
<h2 id="section-3">Выводим список доступных виртуальных машин</h2>
<p>Теперь, когда всё готово, приступим к выводу списка виртуальных машин (убедитесь, что у вас установлен VirtualBox). Если вы ещё не забыли, то для отображения списка виртуальных машин мы будем использовать дереро (<code>TreeView</code>), где каждая виртуальная машина будет корневым узлом. Для этого нам необходимо создать класс, который реализует интерфейс <code>TreeDataProvider</code>, с помощью которого <code>TreeView</code> будет понимать, какие данные необходимо отобразить. Ну что ж, создадим два файла в папке <code>src</code>:</p>
<ul>
<li><code>vmsProvider.ts</code> - содержит реализацию <code>TreeDataProvider</code>;</li>
<li><code>vmTreeitem.ts</code> - содержит реализаци узла дерева, который будем отображать виртуальную машину.</li>
</ul>
<div class="language-ts highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// vmTreeitem.ts</span>

<span class="k">import</span> <span class="o">*</span> <span class="k">as</span> <span class="nx">vscode</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">vscode</span><span class="dl">'</span><span class="p">;</span>
<span class="k">import</span> <span class="p">{</span> <span class="nx">VirtualMachine</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">./utils</span><span class="dl">'</span><span class="p">;</span>

<span class="k">export</span> <span class="kd">class</span> <span class="nx">VirtualMachineTreeItem</span> <span class="kd">extends</span> <span class="nx">vscode</span><span class="p">.</span><span class="nx">TreeItem</span> <span class="p">{</span>
    <span class="kd">constructor</span><span class="p">(</span><span class="kr">public</span> <span class="nx">readonly</span> <span class="nx">vm</span><span class="p">:</span> <span class="nx">VirtualMachine</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">super</span><span class="p">(</span><span class="nx">vm</span><span class="p">.</span><span class="nx">name</span><span class="p">);</span>

        <span class="k">this</span><span class="p">.</span><span class="nx">id</span> <span class="o">=</span> <span class="nx">vm</span><span class="p">.</span><span class="nx">id</span><span class="p">;</span>
        <span class="c1">// Отображаем соответствующие иконки для запущенной и выключеной виртуальных машин</span>
        <span class="c1">// https://microsoft.github.io/vscode-codicons/dist/codicon.html - стандартные иконки codicon</span>
        <span class="c1">// https://code.visualstudio.com/updates/v1_42#_codicons-for-reuse - как использовать codicon в своих расширениях</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">iconPath</span> <span class="o">=</span> <span class="nx">vm</span><span class="p">.</span><span class="nx">running</span> <span class="p">?</span> <span class="k">new</span> <span class="nx">vscode</span><span class="p">.</span><span class="nx">ThemeIcon</span><span class="p">(</span><span class="dl">"</span><span class="s2">vm-running</span><span class="dl">"</span><span class="p">)</span> <span class="p">:</span> <span class="k">new</span> <span class="nx">vscode</span><span class="p">.</span><span class="nx">ThemeIcon</span><span class="p">(</span><span class="dl">"</span><span class="s2">vm</span><span class="dl">"</span><span class="p">);</span>
        <span class="c1">// В зависимости от значения contextValue мы можем отображать те или иные экшены для узла дерева.</span>
        <span class="c1">// С этим мы разберемся в следующей главе</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">contextValue</span> <span class="o">=</span> <span class="nx">vm</span><span class="p">.</span><span class="nx">running</span> <span class="p">?</span> <span class="dl">"</span><span class="s2">vmRunning</span><span class="dl">"</span> <span class="p">:</span> <span class="dl">"</span><span class="s2">vmStopped</span><span class="dl">"</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="c1">// vmsProvider.ts</span>

<span class="k">import</span> <span class="o">*</span> <span class="k">as</span> <span class="nx">vscode</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">vscode</span><span class="dl">'</span><span class="p">;</span>
<span class="k">import</span> <span class="p">{</span> <span class="nx">getAllVms</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">./utils</span><span class="dl">'</span><span class="p">;</span>
<span class="k">import</span> <span class="p">{</span> <span class="nx">VirtualMachineTreeItem</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">./vmTreeitem</span><span class="dl">'</span><span class="p">;</span>

<span class="k">export</span> <span class="kd">class</span> <span class="nx">VirtualMachinesProvider</span> <span class="kr">implements</span> <span class="nx">vscode</span><span class="p">.</span><span class="nx">TreeDataProvider</span><span class="o">&lt;</span><span class="nx">vscode</span><span class="p">.</span><span class="nx">TreeItem</span><span class="o">&gt;</span> <span class="p">{</span>
    <span class="kr">private</span> <span class="na">_onDidChangeTreeData</span><span class="p">:</span> <span class="nx">vscode</span><span class="p">.</span><span class="nx">EventEmitter</span><span class="o">&lt;</span><span class="nx">VirtualMachineTreeItem</span> <span class="o">|</span> <span class="kc">undefined</span><span class="o">&gt;</span> 
        <span class="o">=</span> <span class="k">new</span> <span class="nx">vscode</span><span class="p">.</span><span class="nx">EventEmitter</span><span class="o">&lt;</span><span class="nx">VirtualMachineTreeItem</span> <span class="o">|</span> <span class="kc">undefined</span><span class="o">&gt;</span><span class="p">();</span>
    <span class="nx">readonly</span> <span class="na">onDidChangeTreeData</span><span class="p">:</span> <span class="nx">vscode</span><span class="p">.</span><span class="nx">Event</span><span class="o">&lt;</span><span class="nx">VirtualMachineTreeItem</span> <span class="o">|</span> <span class="kc">undefined</span><span class="o">&gt;</span> 
        <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">_onDidChangeTreeData</span><span class="p">.</span><span class="nx">event</span><span class="p">;</span>

    <span class="c1">// Метод не является частью интерфейса TreeDataProvider. </span>
    <span class="c1">// С его помощью мы можем принудительно перезагрузить дерево или определенный узел,</span>
    <span class="c1">// например, когда состояния виртуальной машины изменилось (выключилась/включилась)</span>
    <span class="nx">refresh</span><span class="p">(</span><span class="nx">item</span><span class="p">?:</span> <span class="nx">VirtualMachineTreeItem</span><span class="p">):</span> <span class="k">void</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">_onDidChangeTreeData</span><span class="p">.</span><span class="nx">fire</span><span class="p">(</span><span class="nx">item</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="nx">getTreeItem</span><span class="p">(</span><span class="na">element</span><span class="p">:</span> <span class="nx">vscode</span><span class="p">.</span><span class="nx">TreeItem</span><span class="p">):</span> <span class="nx">vscode</span><span class="p">.</span><span class="nx">TreeItem</span> <span class="o">|</span> <span class="nx">Thenable</span><span class="o">&lt;</span><span class="nx">vscode</span><span class="p">.</span><span class="nx">TreeItem</span><span class="o">&gt;</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">element</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="nx">getChildren</span><span class="p">(</span><span class="nx">element</span><span class="p">?:</span> <span class="nx">vscode</span><span class="p">.</span><span class="nx">TreeItem</span><span class="p">):</span> <span class="nx">vscode</span><span class="p">.</span><span class="nx">ProviderResult</span><span class="o">&lt;</span><span class="nx">vscode</span><span class="p">.</span><span class="nx">TreeItem</span><span class="p">[]</span><span class="o">&gt;</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">getAllVms</span><span class="p">()</span>
            <span class="p">.</span><span class="nx">then</span><span class="p">((</span><span class="nx">vms</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="nx">vms</span><span class="p">.</span><span class="nx">map</span><span class="p">(</span><span class="nx">vm</span> <span class="o">=&gt;</span> <span class="k">new</span> <span class="nx">VirtualMachineTreeItem</span><span class="p">(</span><span class="nx">vm</span><span class="p">)))</span>
            <span class="p">.</span><span class="k">catch</span><span class="p">((</span><span class="nx">err</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
                <span class="c1">// Показываем сообщение с ошибкой, если вдруг всё пошло не по плану</span>
                <span class="nx">vscode</span><span class="p">.</span><span class="nb">window</span><span class="p">.</span><span class="nx">showErrorMessage</span><span class="p">(</span><span class="nx">err</span><span class="p">);</span>
                <span class="k">return</span> <span class="p">[];</span>
            <span class="p">});</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>
<p>И теперь нам необходимо зарегистрировать созданный <code>VirtualMachinesProvider</code>. Для этого в файле <code>extension.ts</code> заменим метод <code>activate</code> на следующий:</p>
<div class="language-ts highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">export</span> <span class="kd">function</span> <span class="nx">activate</span><span class="p">(</span><span class="nx">context</span><span class="p">:</span> <span class="nx">vscode</span><span class="p">.</span><span class="nx">ExtensionContext</span><span class="p">)</span> <span class="p">{</span>
	<span class="kd">const</span> <span class="nx">vmProvider</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">VirtualMachinesProvider</span><span class="p">();</span>
    <span class="c1">// Регистрируем TreeView внутри "vb-machines"</span>
	<span class="nx">vscode</span><span class="p">.</span><span class="nb">window</span><span class="p">.</span><span class="nx">registerTreeDataProvider</span><span class="p">(</span><span class="dl">"</span><span class="s2">vb-machines</span><span class="dl">"</span><span class="p">,</span> <span class="nx">vmProvider</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div></div>
<p>Давайте наконец-то запустим наш extension:</p>
<p><img src="/assets/virtualbox-vscode-extension/vms-list.png" alt="Список виртуальных машин" /></p>
<p>Отлично! Идём дальше! 🎉🎉🎉</p>
<h2 id="section-4">Реализовываем управление виртульаными машинами</h2>
<p>Мы сделали первый шаг, но расширение всё ещё совершенно бесполезное, поэтому давайте заставим его приносить хоть какую-то пользу. Запуск любых действий в VS Code производится с помощью <a href="https://code.visualstudio.com/api/extension-guides/command">команд</a>. Команды добавляются с помощью уже хорошо нам знакомых <a href="https://code.visualstudio.com/api/references/contribution-points">Contribution Points</a>. Давайте добавим две команды в узлы дерева с нашими виртуальными машинами:</p>
<ul>
<li>для включения виртуальной машины - <code>virtualbox-extension.runVM</code></li>
<li>для выключения виртуальной машины - <code>virtualbox-extension.saveStateVM</code></li>
</ul>
<p>для этого нужно добавить поля <code>commands</code> и <code>menus</code> в секцию <code>contributes</code>:</p>
<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nl">"contributes"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="err">//</span><span class="w"> </span><span class="err">...</span><span class="w">
    </span><span class="nl">"commands"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
      </span><span class="p">{</span><span class="w">
        </span><span class="nl">"command"</span><span class="p">:</span><span class="w"> </span><span class="s2">"virtualbox-extension.runVM"</span><span class="p">,</span><span class="w">
        </span><span class="nl">"category"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Virtual Box"</span><span class="p">,</span><span class="w">
        </span><span class="nl">"title"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Run Virtual Machine"</span><span class="p">,</span><span class="w">
        </span><span class="nl">"icon"</span><span class="p">:</span><span class="w"> </span><span class="s2">"$(run)"</span><span class="w">
      </span><span class="p">},</span><span class="w">
      </span><span class="p">{</span><span class="w">
        </span><span class="nl">"command"</span><span class="p">:</span><span class="w"> </span><span class="s2">"virtualbox-extension.saveStateVM"</span><span class="p">,</span><span class="w">
        </span><span class="nl">"category"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Virtual Box"</span><span class="p">,</span><span class="w">
        </span><span class="nl">"title"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Stop Virtual Machine (state will be saved)"</span><span class="p">,</span><span class="w">
        </span><span class="nl">"icon"</span><span class="p">:</span><span class="w"> </span><span class="s2">"$(debug-stop)"</span><span class="w">
      </span><span class="p">}</span><span class="w">
    </span><span class="p">],</span><span class="w">
    </span><span class="nl">"menus"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="nl">"view/item/context"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
        </span><span class="p">{</span><span class="w">
          </span><span class="nl">"command"</span><span class="p">:</span><span class="w"> </span><span class="s2">"virtualbox-extension.runVM"</span><span class="p">,</span><span class="w">
          </span><span class="nl">"group"</span><span class="p">:</span><span class="w"> </span><span class="s2">"inline"</span><span class="p">,</span><span class="w">
          </span><span class="nl">"when"</span><span class="p">:</span><span class="w"> </span><span class="s2">"viewItem == vmStopped &amp;&amp; view == vb-machines"</span><span class="w">
        </span><span class="p">},</span><span class="w">
        </span><span class="p">{</span><span class="w">
          </span><span class="nl">"command"</span><span class="p">:</span><span class="w"> </span><span class="s2">"virtualbox-extension.saveStateVM"</span><span class="p">,</span><span class="w">
          </span><span class="nl">"group"</span><span class="p">:</span><span class="w"> </span><span class="s2">"inline"</span><span class="p">,</span><span class="w">
          </span><span class="nl">"when"</span><span class="p">:</span><span class="w"> </span><span class="s2">"viewItem == vmRunning &amp;&amp; view == vb-machines"</span><span class="w">
        </span><span class="p">}</span><span class="w">
      </span><span class="p">],</span><span class="w">
      </span><span class="nl">"commandPalette"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
        </span><span class="p">{</span><span class="w">
          </span><span class="nl">"command"</span><span class="p">:</span><span class="w"> </span><span class="s2">"virtualbox-extension.runVM"</span><span class="p">,</span><span class="w">
          </span><span class="nl">"when"</span><span class="p">:</span><span class="w"> </span><span class="s2">"false"</span><span class="w">
        </span><span class="p">},</span><span class="w">
        </span><span class="p">{</span><span class="w">
          </span><span class="nl">"command"</span><span class="p">:</span><span class="w"> </span><span class="s2">"virtualbox-extension.saveStateVM"</span><span class="p">,</span><span class="w">
          </span><span class="nl">"when"</span><span class="p">:</span><span class="w"> </span><span class="s2">"false"</span><span class="w">
        </span><span class="p">}</span><span class="w">
      </span><span class="p">]</span><span class="w">
    </span><span class="p">}</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span></code></pre></div></div>
<p>Давайте разберемся, что здесь происходит.</p>
<p>Все команды, необходимые для расширения помещаются в секцию <code>commands</code>, поэтому именно сюда мы добавляем наши команды и указываем для них <code>category</code>, <code>title</code> и <code>icon</code>. Для того, чтобы поместить команду в виде кнопки в наше дерево, необходимо добавить секцию <code>menus</code>, содержащей секцию <code>view/item/context</code>. Здесь необходимо обратить внимание на поле <a href="https://code.visualstudio.com/docs/getstarted/keybindings#_when-clause-contexts"><code>when</code></a> с помощью которого можно регулировать видимость команды внутри узла дерева. Здесь нам и пригодится <code>contextValue</code>, которое мы объявили в <code>VirtualMachineTreeItem</code>, чтобы показывать кнопку запуска для выключеной виртуалки и кнопку выключения для запущенной. Подробнее обо всём этом можно почитать в <a href="https://code.visualstudio.com/api/extension-guides/tree-view">официальной документации для TreeView</a>. Ну и для простоты мы скроем наши команды из <em>Command Palette</em> (панель которая показывается при нажатии <code>CTRL/CMD+P</code>) с помощью <code>menus.commandPalette</code>.</p>
<p>Теперь нам необходимо зарегистрировать обработчики для объявленных команд. Добавим следующий код в метод <code>activate</code> в файле <code>extension.ts</code>:</p>
<div class="language-ts highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">context</span><span class="p">.</span><span class="nx">subscriptions</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span>
    <span class="nx">vscode</span><span class="p">.</span><span class="nx">commands</span><span class="p">.</span><span class="nx">registerCommand</span><span class="p">(</span><span class="dl">'</span><span class="s1">virtualbox-extension.runVM</span><span class="dl">'</span><span class="p">,</span> <span class="k">async</span> <span class="p">(</span><span class="nx">vmTreeItem</span><span class="p">?:</span> <span class="nx">VirtualMachineTreeItem</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">vmTreeItem</span><span class="p">)</span> <span class="p">{</span>
            <span class="kd">const</span> <span class="p">{</span> <span class="nx">vm</span> <span class="p">}</span> <span class="o">=</span> <span class="nx">vmTreeItem</span><span class="p">;</span>
            <span class="kd">const</span> <span class="nx">running</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">isRunning</span><span class="p">(</span><span class="nx">vm</span><span class="p">.</span><span class="nx">id</span><span class="p">);</span>

            <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">running</span><span class="p">)</span> <span class="p">{</span>
                <span class="k">try</span> <span class="p">{</span>
                    <span class="k">await</span> <span class="nx">startWithGui</span><span class="p">(</span><span class="nx">vm</span><span class="p">.</span><span class="nx">id</span><span class="p">);</span>
                    <span class="nx">vscode</span><span class="p">.</span><span class="nb">window</span><span class="p">.</span><span class="nx">showInformationMessage</span><span class="p">(</span><span class="s2">`Virtual machine "</span><span class="p">${</span><span class="nx">vm</span><span class="p">.</span><span class="nx">name</span><span class="p">}</span><span class="s2">" has been run successfully`</span><span class="p">);</span>
                <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="nx">ex</span><span class="p">)</span> <span class="p">{</span>
                    <span class="nx">vscode</span><span class="p">.</span><span class="nb">window</span><span class="p">.</span><span class="nx">showErrorMessage</span><span class="p">(</span><span class="s2">`Cannot run virtual machine "</span><span class="p">${</span><span class="nx">vm</span><span class="p">.</span><span class="nx">name</span><span class="p">}</span><span class="s2">": </span><span class="p">${</span><span class="nx">ex</span> <span class="o">&amp;&amp;</span> <span class="nx">ex</span><span class="p">.</span><span class="nx">message</span> <span class="o">||</span> <span class="dl">"</span><span class="s2">Unknown error</span><span class="dl">"</span> <span class="p">}</span><span class="s2">`</span><span class="p">);</span>
                <span class="p">}</span>
            <span class="p">}</span>

            <span class="nx">vmProvider</span><span class="p">.</span><span class="nx">refresh</span><span class="p">();</span>
        <span class="p">}</span>
    <span class="p">}),</span>
    <span class="nx">vscode</span><span class="p">.</span><span class="nx">commands</span><span class="p">.</span><span class="nx">registerCommand</span><span class="p">(</span><span class="dl">"</span><span class="s2">virtualbox-extension.saveStateVM</span><span class="dl">"</span><span class="p">,</span> <span class="k">async</span> <span class="p">(</span><span class="na">vmTreeItem</span><span class="p">:</span> <span class="nx">VirtualMachineTreeItem</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">vmTreeItem</span><span class="p">)</span> <span class="p">{</span>
            <span class="kd">const</span> <span class="p">{</span> <span class="nx">vm</span> <span class="p">}</span> <span class="o">=</span> <span class="nx">vmTreeItem</span><span class="p">;</span>

            <span class="kd">const</span> <span class="nx">running</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">isRunning</span><span class="p">(</span><span class="nx">vm</span><span class="p">.</span><span class="nx">id</span><span class="p">);</span>
            <span class="k">if</span> <span class="p">(</span><span class="nx">running</span><span class="p">)</span> <span class="p">{</span>
                <span class="k">try</span> <span class="p">{</span>
                    <span class="k">await</span> <span class="nx">saveState</span><span class="p">(</span><span class="nx">vm</span><span class="p">.</span><span class="nx">id</span><span class="p">);</span>
                    <span class="nx">vscode</span><span class="p">.</span><span class="nb">window</span><span class="p">.</span><span class="nx">showInformationMessage</span><span class="p">(</span><span class="s2">`Virtual machine "</span><span class="p">${</span><span class="nx">vm</span><span class="p">.</span><span class="nx">name</span><span class="p">}</span><span class="s2">" has been stopped successfully`</span><span class="p">);</span>
                <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="nx">ex</span><span class="p">)</span> <span class="p">{</span>
                    <span class="nx">vscode</span><span class="p">.</span><span class="nb">window</span><span class="p">.</span><span class="nx">showErrorMessage</span><span class="p">(</span><span class="s2">`Cannot stop virtual machine "</span><span class="p">${</span><span class="nx">vm</span><span class="p">.</span><span class="nx">name</span><span class="p">}</span><span class="s2">": </span><span class="p">${</span><span class="nx">ex</span> <span class="o">&amp;&amp;</span> <span class="nx">ex</span><span class="p">.</span><span class="nx">message</span> <span class="o">||</span> <span class="dl">"</span><span class="s2">Unknown error</span><span class="dl">"</span> <span class="p">}</span><span class="s2">`</span><span class="p">);</span>
                <span class="p">}</span>
            <span class="p">}</span>
            <span class="nx">vmProvider</span><span class="p">.</span><span class="nx">refresh</span><span class="p">();</span>
        <span class="p">}</span>
    <span class="p">}),</span>
<span class="p">);</span>
</code></pre></div></div>
<p>Здесь нам и пригодились утилитные методы объявленные в файле <code>utils.ts</code>.
Конечный вариант файла <code>extension.ts</code> вы можете найти в <a href="https://github.com/acherkashin/virtualbox-vscode-extension/blob/master/src/extension.ts">репозитории</a>:</p>
<p>Теперь, когда всё готово, давайте запустим наш extension:</p>
<p class="vm-images">
    <img class="vm-images__image" src="/assets/virtualbox-vscode-extension/running-vm.gif" alt="Запуск виртуальной машины"/>
    <img class="vm-images__image" src="/assets/virtualbox-vscode-extension/stopping-vm.gif" alt="Выключение виртуальной машины"/>
</p>
<h2 id="section-5">Публикация</h2>
<p>Теперь, когда наше приложение готово, мы можем его опубликовать. Подробнее с процессом публикации вы можете познакомиться в <a href="https://code.visualstudio.com/api/working-with-extensions/publishing-extension">официальной документации</a>. А я расскажу об этом вкратце.</p>
<p>Устанавливаем <a href="https://github.com/microsoft/vscode-vsce">vsce</a> (Visual Studio Code Extension Manager)</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>npm <span class="nb">install</span> <span class="nt">-g</span> vsce
</code></pre></div></div>
<p><a href="https://code.visualstudio.com/api/working-with-extensions/publishing-extension#get-a-personal-access-token">Получаем Personal Access Token</a>. Не забудьте скопировать PAT сразу после создания, иначе он будет утерян, так как Microsoft не хранит PAT.</p>
<p>Убеждаемся, что в <code>package.json</code> заполнены следующие поля (Но значения нужно указать ваши, а не мои 😜).</p>
<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nl">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"virtualbox-extension"</span><span class="err">,</span><span class="w">
</span><span class="nl">"displayName"</span><span class="p">:</span><span class="w"> </span><span class="s2">"VirtualBox"</span><span class="err">,</span><span class="w">
</span><span class="nl">"description"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Extension allows to manage your VMs right from Visual Studio Code"</span><span class="err">,</span><span class="w">
</span><span class="nl">"publisher"</span><span class="p">:</span><span class="w"> </span><span class="s2">"acherkashin"</span><span class="err">,</span><span class="w">
</span><span class="nl">"icon"</span><span class="p">:</span><span class="w"> </span><span class="s2">"images/virtualbox-extension-icon.png"</span><span class="err">,</span><span class="w">
</span><span class="nl">"repository"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nl">"url"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://github.com/acherkashin/virtualbox-vscode-extension"</span><span class="w">
</span><span class="p">}</span><span class="err">,</span><span class="w">
</span></code></pre></div></div>
<p>Особое внимание необходимо обратить на поле <code>publisher</code>, оно нам пригодится в следующем шаге.</p>
<p>Создаем <code>publisher</code> с тем же имененм, которое указано, в <code>package.json</code>. Как только, вы получили <a href="https://code.visualstudio.com/api/working-with-extensions/publishing-extension#get-a-personal-access-token">Personal Access Token</a>, вы можете создать <code>publisher</code> используя <code>vsce</code>:</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>vsce create-publisher <span class="o">(</span>publisher name<span class="o">)</span>
</code></pre></div></div>
<p>Публикуем расширение с помощью следующей команды:</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>vsce publish <span class="nt">-p</span> <span class="o">(</span>access token<span class="o">)</span>
</code></pre></div></div>
<p>Всё готово. На этом наш путь завершен!</p>
<h2 id="section-6">Итоги</h2>
<p>Давайте ненадолго остановимся и подведем итог. Мы разобрались:</p>
<ul>
<li>Как сгенерировать VS Code extension;</li>
<li>Как управлять VirtualBox, с помощью пакета <a href="https://github.com/Node-Virtualization/node-virtualbox">node-virtualbox</a>;</li>
<li>Как отображать информацию в виде дерева с помощью <code>TreeDataProvider</code>;</li>
<li>Что такое <em>Команды</em> и как ими пользоваться;</li>
<li>Как происходит публикация extension в Marketplace.</li>
</ul>
<p>Также рекомендую почитать официальную документацию <a href="https://code.visualstudio.com/api">VS Code Extension API</a>. И <a href="https://github.com/microsoft/vscode-extension-samples">репозиторий с примерами расширений</a>, где достаточно наглядно продемонстрированы все их возможности.</p>

  </div></div>

      </section>
    </main></body>
</html>
